<div id="paypal-button-container" style="margin-top: 20px; width: 100%"></div>

<!-- Include the PayPal JavaScript SDK -->
<script src="https://www.paypal.com/sdk/js?client-id=Ac0JzE2C2gleebo98WHQI7V4QE3O_Fns0HEjnFPe0-_sNljwKvcadlNO90qK-27KIF6K_SXocXehmRrA&currency=USD"></script>

<script>
    function getCookie(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = cookies[i].trim();
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    var csrftoken = getCookie('csrftoken'); 
    var total = '{{total|currency:request.session.currency }} {{ request.session.currency }}';
    var orderID = '{{ order.id }}';
    var url = "{% url 'payment_complete' %}";
    // Render the PayPal button into #paypal-button-container
    paypal.Buttons({
        style: {
            color:  'blue',
            shape:  'pill',
            label:  'pay',
            height: 40,
        },
        // Set up the transaction
        createOrder: function (data, actions) {
            return actions.order.create({
            purchase_units: [
                {
                    amount: {
                        value: parseFloat(total).toFixed(2),
                    },
                },
            ],
            });
        },
        
        // Finalize the transaction
        onApprove: function(data, actions) {
            return actions.order.capture().then(function(details) {
                console.log(details)
                sendData()
                function sendData(){
                    fetch(url, {
                        method: 'POST',
                        header: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': csrftoken,
                        },
                        body: JSON.stringify({ 'orderID': orderID, 'payID': details.id }),
                    })
                }
                // Show a success message to the buyer
                
                alert('Transaction completed by ' + details.payer.name.given_name + '!');
            });
        },
    }).render('#paypal-button-container');

</script>